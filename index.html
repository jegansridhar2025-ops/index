<!DOCTYPE html>
<html>
<head>
<title>Tuition Center Management System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* RESET & BASE */
*{margin:0; padding:0; box-sizing:border-box;}
body{ font-family:'Roboto', sans-serif; background:#f2f5f8; }

/* LOGIN PAGE STYLING */
body.loginBody{ 
  background: linear-gradient(135deg,#1e3d59,#3a6073,#1e3d59);
  background-size: 400% 400%;
  animation: gradientBG 10s ease infinite;
}
@keyframes gradientBG {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

.login-box{
  width:350px; 
  margin:100px auto; 
  padding:40px 30px; 
  background:white; 
  border-radius:15px; 
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  text-align:center;
  transition: 0.3s;
}
.login-box:hover{ transform: translateY(-5px); }
.login-box h2{ color:#17324d; margin-bottom:25px; font-weight:700; }
.input-group{ position: relative; margin:15px 0; }
.input-group span{ position:absolute; left:10px; top:50%; transform:translateY(-50%); font-size:18px; }
.input-group input{ width:100%; padding:12px 12px 12px 40px; border:1px solid #ccc; border-radius:8px; font-size:14px; transition:0.3s; }
.input-group input:focus{ border-color:#007bff; box-shadow:0 0 8px rgba(0,123,255,0.3); outline:none; }
.btn-group{ display:flex; justify-content:space-between; margin-top:20px; }
.btn-group button{ width:48%; padding:12px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; transition:0.3s; }
.btn-group button:first-child{ background:#007bff; color:white; }
.btn-group button:first-child:hover{ background:#0056b3; }
.btn-group button:last-child{ background:#28a745; color:white; }
.btn-group button:last-child:hover{ background:#1e7e34; }
#loginMsg{ margin-top:15px; color:red; font-weight:500; min-height:20px; transition:0.3s; }

/* HEADER */
header{
    background: linear-gradient(90deg,#1e3d59,#3a6073);
    color:white; 
    padding:20px 40px; 
    display:flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
header h2{ font-weight:500; }
header button{ padding:10px 20px; border:none; background:#ff4d4f; color:white; border-radius:5px; cursor:pointer; transition:0.3s;}
header button:hover{ background:#d9363e; }

/* LAYOUT */
.container{ display:flex; min-height:calc(100vh - 80px); }
.sidebar{ width:220px; background:#17324d; color:white; display:flex; flex-direction:column; padding-top:20px; }
.sidebar button{ width:100%; padding:15px 20px; border:none; background:none; color:white; text-align:left; font-size:15px; cursor:pointer; transition:0.3s; }
.sidebar button:hover{ background:#1e3d59; font-weight:bold; border-left:4px solid #ffce00; }
.content{ flex:1; padding:30px; overflow-x:auto; }

/* CARD STYLE SECTIONS */
.section{ background:white; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.05); margin-bottom:20px; }

/* TABLES */
table{ width:100%; border-collapse:collapse; margin-top:20px; background:white; border-radius:10px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.05);}
th,td{ padding:12px; text-align:center; border-bottom:1px solid #eee; }
th{ background:#1e3d59; color:white; font-weight:500; }
tr:hover{ background:#f1f6f9; }
.present{ background:#28a745; color:white; border-radius:5px; padding:5px 10px; cursor:pointer; }
.absent{ background:#ff4d4f; color:white; border-radius:5px; padding:5px 10px; cursor:pointer; }

/* BUTTONS */
button{ padding:8px 15px; border:none; border-radius:5px; cursor:pointer; transition:0.3s; font-weight:500; }
button:hover{ opacity:0.9; }
.blue-btn{ background:#007bff; color:white; }
.blue-btn:hover{ background:#0056b3; }
.green-btn{ background:#28a745; color:white; }
.green-btn:hover{ background:#1e7e34; }

/* INPUTS & SELECTS */
input, select{ padding:10px; margin:5px 0; border:1px solid #ccc; border-radius:5px; }

/* PERCENTAGE BAR */
.bar-container{ background:#ddd; width:100%; height:20px; border-radius:5px; margin:5px 0; }
.bar{ height:100%; border-radius:5px; text-align:center; color:white; font-size:12px; line-height:20px; }

/* CALENDAR STYLING */
#calendarArea table th, #calendarArea table td{ padding:5px; font-size:12px; }
</style>
</head>
<body class="loginBody">

<!-- LOGIN PAGE -->
<div id="loginPage" class="login-box">
  <h2>üéì Teacher Login</h2>
  <div class="input-group">
    <span>üë§</span>
    <input type="text" id="username" placeholder="Username">
  </div>
  <div class="input-group">
    <span>üîí</span>
    <input type="password" id="password" placeholder="Password">
  </div>
  <div class="btn-group">
    <button onclick="createLogin()">Create Login</button>
    <button onclick="login()">Login</button>
  </div>
  <p id="loginMsg"></p>
</div>

<!-- MAIN PAGE -->
<div id="mainPage" style="display:none;">
<header>
<h2>Tuition Center Dashboard</h2>
<button onclick="logout()">Logout</button>
</header>

<div class="container">
<div class="sidebar">
<button onclick="showSection('attendance')">üìã Daily Attendance</button>
<button onclick="showSection('percentage')">üìä Attendance %</button>
<button onclick="showSection('marks')">üìù Marks</button>
<button onclick="showSection('students')">üë®‚Äçüéì Students</button>
<button onclick="showSection('calendar')">üìÖ Monthly Calendar</button>
</div>

<div class="content">

<!-- ATTENDANCE -->
<div id="attendance" class="section">
<h3>Daily Attendance</h3>
<select id="classSelect" onchange="loadAttendance()">
<option value="">Select Class</option>
<option value="1">1st Std</option>
<option value="2">2nd Std</option>
<option value="3">3rd Std</option>
<option value="4">4th Std</option>
<option value="5">5th Std</option>
<option value="6">6th Std</option>
<option value="7">7th Std</option>
<option value="8">8th Std</option>
<option value="9">9th Std</option>
<option value="10">10th Std</option>
<option value="11">11th Std</option>
<option value="12">12th Std</option>
</select>
<input type="date" id="attDate" onchange="loadAttendance()">
<div style="margin-top:10px;">
  <button id="finalizeBtn" class="blue-btn" onclick="finalizeAttendance()">Finalize Attendance</button>
  <button class="green-btn" onclick="downloadClassFullPDF(document.getElementById('classSelect').value)">Download Whole Class PDF</button>
</div>
<div id="attendanceArea"></div>
<p id="finalizeMsg" style="color:green; margin-top:10px;"></p>
</div>

<!-- PERCENTAGE -->
<div id="percentage" class="section" style="display:none;">
<h3>Attendance Percentage</h3>
<select id="percentClassSelect" onchange="showPercentage()">
<option value="">Select Class</option>
<option value="1">1st Std</option>
<option value="2">2nd Std</option>
<option value="3">3rd Std</option>
<option value="4">4th Std</option>
<option value="5">5th Std</option>
<option value="6">6th Std</option>
<option value="7">7th Std</option>
<option value="8">8th Std</option>
<option value="9">9th Std</option>
<option value="10">10th Std</option>
<option value="11">11th Std</option>
<option value="12">12th Std</option>
</select>
<div id="percentageArea"></div>
</div>

<!-- MARKS -->
<div id="marks" class="section" style="display:none;">
<h3>Add Exam Marks</h3>
<select id="marksClassSelect" onchange="loadMarksStudent()">
<option value="">Select Class</option>
<option value="1">1st Std</option>
<option value="2">2nd Std</option>
<option value="3">3rd Std</option>
<option value="4">4th Std</option>
<option value="5">5th Std</option>
<option value="6">6th Std</option>
<option value="7">7th Std</option>
<option value="8">8th Std</option>
<option value="9">9th Std</option>
<option value="10">10th Std</option>
<option value="11">11th Std</option>
<option value="12">12th Std</option>
</select>
<select id="markStudent"></select>
<input type="text" id="examName" placeholder="Exam Name">
<input type="number" id="examMark" placeholder="Marks">
<button onclick="addMarks()">Add</button>
<div id="marksArea"></div>
</div>

<!-- STUDENTS -->
<div id="students" class="section" style="display:none;">
<h3>Add Student</h3>
<input type="text" id="studentName" placeholder="Student Name">
<select id="studentClass">
<option value="">Select Class</option>
<option value="1">1st Std</option>
<option value="2">2nd Std</option>
<option value="3">3rd Std</option>
<option value="4">4th Std</option>
<option value="5">5th Std</option>
<option value="6">6th Std</option>
<option value="7">7th Std</option>
<option value="8">8th Std</option>
<option value="9">9th Std</option>
<option value="10">10th Std</option>
<option value="11">11th Std</option>
<option value="12">12th Std</option>
</select>
<input type="text" id="studentAge" placeholder="Age">
<input type="text" id="studentPhone" placeholder="Phone">
<button onclick="addStudent()">Add Student</button>
<h3>Student List</h3>
<div id="studentList"></div>
</div>

<!-- MONTHLY CALENDAR -->
<div id="calendar" class="section" style="display:none;">
<h3>Monthly Attendance Calendar</h3>
<select id="calendarClassSelect" onchange="generateCalendar()">
<option value="">Select Class</option>
<option value="1">1st Std</option>
<option value="2">2nd Std</option>
<option value="3">3rd Std</option>
<option value="4">4th Std</option>
<option value="5">5th Std</option>
<option value="6">6th Std</option>
<option value="7">7th Std</option>
<option value="8">8th Std</option>
<option value="9">9th Std</option>
<option value="10">10th Std</option>
<option value="11">11th Std</option>
<option value="12">12th Std</option>
</select>
<input type="month" id="calendarMonth" onchange="generateCalendar()" value="">
<div style="margin-top:10px;">
  <button class="green-btn" onclick="downloadMonthlyPDF()">Download Monthly PDF</button>
</div>
<div id="calendarArea"></div>
</div>

</div>
</div>
</div>

<script>
// ==== DATA ====
let students = JSON.parse(localStorage.getItem("students")) || [];
let attendance = JSON.parse(localStorage.getItem("attendance")) || {};
let finalizedDates = JSON.parse(localStorage.getItem("finalizedDates")) || {};
let marks = JSON.parse(localStorage.getItem("marks")) || {};

// ==== LOGIN ====
function createLogin(){ localStorage.setItem("user",username.value); localStorage.setItem("pass",password.value); loginMsg.innerText="Login Created Successfully!"; }
function login(){ 
  if(username.value===localStorage.getItem("user") && password.value===localStorage.getItem("pass")){
    loginPage.style.display="none"; 
    mainPage.style.display="block"; 
    document.body.classList.remove('loginBody');
    loadStudents(); 
  } else{ loginMsg.innerText="Invalid Login!"; }
}
function logout(){ location.reload(); }
function showSection(id){ document.querySelectorAll(".section").forEach(sec=>sec.style.display="none"); document.getElementById(id).style.display="block"; }

// ==== STUDENTS ====
function addStudent(){ students.push({name:studentName.value, studentclass:studentClass.value, age:studentAge.value, phone:studentPhone.value}); localStorage.setItem("students",JSON.stringify(students)); loadStudents();}
function removeStudent(i){ students.splice(i,1); localStorage.setItem("students",JSON.stringify(students)); loadStudents();}
function loadStudents(){ 
    let list="<table><tr><th>S.No</th><th>Name</th><th>Class</th><th>Age</th><th>Phone</th><th>Action</th></tr>"; 
    students.sort((a,b)=>a.name.localeCompare(b.name)).forEach((s,i)=>{ 
        list+=`<tr><td>${i+1}</td><td>${s.name}</td><td>${s.studentclass}</td><td>${s.age}</td><td>${s.phone}</td><td><button onclick="removeStudent(${i})">Remove</button></td></tr>`; 
    }); 
    list+="</table>"; studentList.innerHTML=list; 
}

// ==== ATTENDANCE ====
const attDateInput = document.getElementById("attDate");
attDateInput.value = new Date().toISOString().substr(0,10);

function loadAttendance(){
    let selectedClass = document.getElementById("classSelect").value;
    let date = attDateInput.value;
    if(!selectedClass) { attendanceArea.innerHTML="<p>Please select a class</p>"; return; }
    if(!attendance[date]) attendance[date]={};

    let html="<table><tr><th>S.No</th><th>Name</th><th>Status</th><th>Download Full PDF</th></tr>";
    let filteredStudents = students.filter(s=>s.studentclass===selectedClass).sort((a,b)=>a.name.localeCompare(b.name));
    filteredStudents.forEach((s,index)=>{
        if(!attendance[date][s.name]) attendance[date][s.name]="Present";
        let status=attendance[date][s.name], cls=status==="Present"?"present":"absent";
        let isFinalized = finalizedDates[date]?.includes(selectedClass);
        if(isFinalized){
            html+=`<tr><td>${index+1}</td><td>${s.name}</td><td><button class="${cls}" disabled>${status}</button></td>
                   <td><button onclick="downloadStudentFullPDF('${s.name}')">Download Full PDF</button></td></tr>`;
        } else {
            html+=`<tr><td>${index+1}</td><td>${s.name}</td><td><button class="${cls}" onclick="toggleAttendance('${date}','${s.name}')">${status}</button></td>
                   <td><button onclick="downloadStudentFullPDF('${s.name}')">Download Full PDF</button></td></tr>`;
        }
    });
    html+="</table>"; attendanceArea.innerHTML=html;
    if(finalizedDates[date]?.includes(selectedClass)){
        document.getElementById("finalizeBtn").disabled=true;
        document.getElementById("finalizeMsg").innerText="Attendance finalized for "+selectedClass+" class on "+date;
    } else {
        document.getElementById("finalizeBtn").disabled=false;
        document.getElementById("finalizeMsg").innerText="";
    }
    localStorage.setItem("attendance",JSON.stringify(attendance));
}

function toggleAttendance(date,name){
    let selectedClass = document.getElementById("classSelect").value;
    if(finalizedDates[date]?.includes(selectedClass)) return;
    attendance[date][name]=attendance[date][name]==="Present"?"Absent":"Present";
    localStorage.setItem("attendance",JSON.stringify(attendance));
    loadAttendance();
}

function finalizeAttendance(){
    let selectedClass = document.getElementById("classSelect").value;
    let date = attDateInput.value;
    if(!finalizedDates[date]) finalizedDates[date]=[];
    if(!finalizedDates[date].includes(selectedClass)){
        finalizedDates[date].push(selectedClass);
        localStorage.setItem("finalizedDates",JSON.stringify(finalizedDates));
        loadAttendance();
    }
}

// PDF functions are same as your original code...

// Additional functions for Marks, Percentage, Calendar remain unchanged

</script>
</body>
</html>
